<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Mapa Pokecroc - Multi Region</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;800&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        /* ================= ESTILOS GERAIS ================= */
        :root {
            --bg-dark: #050b0c;          
            --panel-bg: #091819;         
            --neon-green: #00ff9d;       
            --border-color: #1f4a42;     
            --btn-top: #6b8e23;          
            --btn-bottom: #4b6b1a;       
            --btn-border: #2f4510;       
            --text-white: #ffffff;
        }

        body { margin: 0; display: flex; font-family: 'Roboto', sans-serif; background-color: var(--bg-dark); overflow: hidden; }
        
        #sidebar {
            width: 320px; background: linear-gradient(to bottom, #081415, #050b0c); color: var(--text-white);
            padding: 20px; height: 100vh; overflow-y: auto; box-shadow: 4px 0 15px rgba(0,0,0,0.8);
            z-index: 1000; border-right: 1px solid var(--border-color); box-sizing: border-box; margin-top: 0;
        }

        #map { height: 100vh; flex-grow: 1; background: #0d1b2a; position: relative; }
        .leaflet-image-layer { image-rendering: pixelated; }

        /* TIPOGRAFIA */
        h2 { font-family: 'Montserrat', sans-serif; color: var(--neon-green); text-align: center; font-size: 1.4rem; border-bottom: 2px solid var(--border-color); padding-bottom: 10px; margin-bottom: 20px; }
        h3 { font-family: 'Montserrat', sans-serif; color: var(--neon-green); font-size: 0.95rem; margin-top: 0; border-bottom: 1px solid rgba(0, 255, 157, 0.2); padding-bottom: 5px; }

        /* CONTROLES */
        .control-group { margin-bottom: 20px; background: var(--panel-bg); padding: 15px; border: 1px solid var(--neon-green); border-radius: 12px; }
        
        select, input { width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 6px; outline: none; box-sizing: border-box; }
        select { background: #0f2b2d; color: var(--neon-green); border: 1px solid var(--neon-green); font-weight: bold; cursor: pointer; }
        input { background: #ffffff; border: 2px solid transparent; color: #333; font-weight: 500; }
        input:focus { border-color: var(--neon-green); }

        .coord-inputs { display: flex; gap: 10px; margin-bottom: 5px; }
        
        button { 
            width: 100%; padding: 12px; cursor: pointer; background: linear-gradient(to bottom, var(--btn-top), var(--btn-bottom));
            color: white; border: 2px solid var(--btn-border); border-radius: 8px; font-family: 'Montserrat', sans-serif; 
            font-weight: 800; text-transform: uppercase; text-shadow: 1px 1px 2px black; transition: all 0.1s; margin-top: 5px;
        }
        button:hover { filter: brightness(1.1); }
        button:active { transform: translateY(2px); }

        /* MENU SUPERIOR */
        #top-menu-panel {
            position: absolute; top: -150px; left: 0; width: 100%; height: 100px;
            background: rgba(9, 24, 25, 0.95); border-bottom: 2px solid var(--neon-green);
            z-index: 2000; transition: top 0.5s ease;
            display: flex; justify-content: center; align-items: center; gap: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.8);
        }
        #top-menu-panel.open { top: 0; }

        .menu-btn {
            width: 160px; height: 60px; font-size: 0.8rem; display: flex; 
            align-items: center; justify-content: center; text-align: center;
            line-height: 1.2; text-decoration: none;
        }
        .menu-btn.disabled { filter: grayscale(1); opacity: 0.5; cursor: not-allowed; }

        #top-menu-trigger {
            position: absolute; top: 0; left: 50%; transform: translateX(-50%);
            width: 40px; height: 30px; background: var(--panel-bg);
            border: 1px solid var(--neon-green); border-top: none;
            border-bottom-left-radius: 10px; border-bottom-right-radius: 10px;
            color: var(--neon-green); text-align: center; cursor: pointer;
            z-index: 2001; line-height: 30px; transition: top 0.5s ease;
        }
        #top-menu-trigger:hover { background: #0f2b2d; }
        #top-menu-trigger.open { top: 100px; }

        /* LAYER ITEMS */
        .layer-item { display: flex; align-items: center; margin-bottom: 8px; cursor: pointer; font-size: 0.9rem; }
        .layer-item input[type="checkbox"] { width: auto; margin: 0 10px 0 0; accent-color: var(--neon-green); cursor: pointer; }

        /* √çCONES */
        .city-label-icon { background: transparent; border: none; white-space: nowrap; }
        .city-label-text {
            color: #f1c40f; font-family: 'Montserrat', sans-serif; font-weight: 800; font-size: 13px;
            text-shadow: 2px 0 0 #000, -2px 0 0 #000, 0 2px 0 #000, 0 -2px 0 #000, 0 0 5px #0000ff, 0 0 10px #0000ff;
            text-align: center; display: block; pointer-events: none;
        }
        .custom-pin { border-radius: 50%; border: 2px solid #000; box-shadow: 0 0 4px rgba(0,0,0,0.8); }
        .pin-white { background-color: #ffffff; } 
        .pin-blue { background-color: #0000ff; }
        .pin-red {background-color: crimson;}
        
        .legendary-icon { background: transparent; border: none; }
        .legendary-img { width: 100%; height: 100%; object-fit: contain; filter: drop-shadow(0 0 5px #ff00ff); }
        .poke-icon { background: transparent; border: none; }
        .poke-img { width: 100%; height: 100%; object-fit: contain; filter: drop-shadow(0 0 5px rgba(255,255,255,0.7)); }
        
        .wiki-link { display: block; margin-top: 8px; padding: 5px; background: #2c3e50; color: #fff; text-decoration: none; border-radius: 4px; font-size: 11px; text-align: center; }
        .map-jump-btn { background: #d35400; border: 1px solid #e67e22; color: white; font-size: 11px; padding: 6px; margin-top: 5px; }

    </style>
</head>
<body>

    <div id="top-menu-panel">
        <button class="menu-btn" onclick="window.open('https://pokecrocut.discloud.app/', '_blank')">Pokecroc<br>Universal Tool</button>
        <button class="menu-btn" onclick="window.location.href='quests.html'">Quests</button>
        <button class="menu-btn disabled">Em Breve</button>
        <button class="menu-btn disabled">Em Breve</button>
        <button class="menu-btn disabled">Em Breve</button>
    </div>
    <div id="top-menu-trigger" onclick="toggleTopMenu()">‚ñº</div>

    <div id="login-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #050b0c url('mapa_kanto.jpg') center/cover no-repeat; z-index: 99999; display: flex; justify-content: center; align-items: center;">
        <div style="background: rgba(9, 24, 25, 0.95); padding: 40px; border-radius: 15px; border: 2px solid #00ff9d; text-align: center; max-width: 400px; width: 90%; box-shadow: 0 0 20px rgba(0,255,157,0.3);">
            <h2 style="color: #00ff9d; font-family: sans-serif; margin-top: 0;">üîí ACESSO RESTRITO</h2>
            <p style="color: #ccc; font-family: sans-serif;">Digite a senha do dia (pegue no Discord !senha)</p>
            <input type="text" id="sitePassword" placeholder="Senha..." style="width: 100%; padding: 15px; margin: 15px 0; background: #0f2b2d; border: 1px solid #1f4a42; color: #00ff9d; font-size: 1.2rem; text-align: center; border-radius: 8px; box-sizing: border-box;">
            <button onclick="tentarLogin()" id="btnLogin" style="width: 100%; padding: 15px; background: linear-gradient(to bottom, #6b8e23, #4b6b1a); border: none; color: white; font-weight: bold; cursor: pointer; border-radius: 8px;">LIBERAR ACESSO</button>
            <p id="loginMsg" style="color: #ff5555; margin-top: 10px; min-height: 20px;"></p>
        </div>
    </div>

    <div id="sidebar">
        <h2>üó∫Ô∏è Pokecroc Maps</h2>

        <div class="control-group">
            <h3>üåé Selecionar Regi√£o</h3>
            <select id="mapSelector" onchange="changeMap(this.value)">
                <option value="kanto">Kanto</option>
                <option value="johto">Johto</option>
                <option value="hoenn">Hoenn</option>
                <option value="aldia">Aldia</option>
            </select>
        </div>

        <div class="control-group">
            <h3>üîç Procurar Pok√©mon</h3>
            <input type="text" id="inputPoke" placeholder="Ex: Charmander..." onkeypress="handleEnterPoke(event)">
            <button onclick="buscarPokemon()">Localizar Pok√©mon</button>
            <p id="msg-poke" style="color: #aaa; font-size: 12px; margin-top: 5px;"></p>
        </div>

        <div class="control-group">
            <h3>üë§ Procurar NPC</h3>
            <input type="text" id="inputNPC" placeholder="Ex: Dark Joe..." onkeypress="handleEnterNPC(event)">
            <button onclick="buscarNPC()">Localizar NPC</button>
            <p id="msg-npc" style="color: #aaa; font-size: 12px; margin-top: 5px;"></p>
        </div>

        <div class="control-group">
            <h3>üìç Ir para Coordenada</h3>
            <div class="coord-inputs">
                <input type="number" id="inputX" placeholder="X">
                <input type="number" id="inputY" placeholder="Y">
            </div>
            <button onclick="buscarCoordenada()">Buscar Local</button>
            <p id="msg-busca" style="color: #aaa; font-size: 12px; margin-top: 5px;"></p>
        </div>

        <div class="control-group">
            <h3>Filtros (Mapa Atual)</h3>
            <div id="layer-controls"></div>
        </div>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // =========================================================
        // CONFIGURA√á√ïES GERAIS E CARREGAMENTO
        // =========================================================
        const layerConfig = {
            'cidades': { label: "Cidades", type: "text", color: "#f1c40f" },
            'rocket': { label: "Bal√£o Rocket", type: "pin", cssClass: "pin-white" },
            'lendarios': { label: "Lend√°rios", type: "sprite", size: [50, 50] },
            'carnaval': { label: "Carnaval", type: "pin", cssClass: "pin-red" }
        };

        const mapsConfig = {
            'kanto': { name: 'Kanto', image: 'mapa_kanto.jpg', width: 4858, height: 5221, minX: 322, maxX: 1536, minY: 568, maxY: 1873 },
            'johto': { name: 'Johto', image: 'mapa_johto.png', width: 1639, height: 1388, minX: 1871, maxX: 3510, minY: 687, maxY: 2075 },
            'hoenn': { name: 'Hoenn', image: 'mapa_hoenn.png', width: 1275, height: 977, minX: 1701, maxX: 2975, minY: 2198, maxY: 3174 },
            'aldia': { name: 'Aldia', image: 'mapa_aldia.png', width: 1294, height: 1064, minX: 225, maxX: 1516, minY: 1633, maxY: 2696 }
        };

        const POKEMON_DB_URL = "https://raw.githubusercontent.com/leandrozampoli/Atualiza-o-mapa-interativo-pokecroc/refs/heads/main/pokemon_db.json";
        const MAP_FEATURES_URL = "https://raw.githubusercontent.com/leandrozampoli/Atualiza-o-mapa-interativo-pokecroc/refs/heads/main/map_features.json"; 
        const NPC_DB_URL = "https://raw.githubusercontent.com/leandrozampoli/Atualiza-o-mapa-interativo-pokecroc/refs/heads/main/npc_db.json";

        let pokemonDB = {};
        let npcDB = {};
        let mapFeatures = {};

        // For√ßa atualiza√ß√£o ao carregar arquivos JSON
        function loadJSON(url, callback, errorMsgId) {
            const freshUrl = `${url}?t=${new Date().getTime()}`;
            fetch(freshUrl).then(r => {
                if(!r.ok) throw new Error(r.status);
                return r.json();
            }).then(data => {
                callback(data);
                console.log(`Carregado (Fresh): ${freshUrl}`);
            }).catch(e => {
                console.error(`Erro ao carregar ${url}:`, e);
                const msg = document.getElementById(errorMsgId);
                if(msg) msg.innerHTML = `<span style='color:red'>Erro DB.</span>`;
            });
        }

        loadJSON(POKEMON_DB_URL, (data) => { 
            pokemonDB = data; 
            document.getElementById('msg-poke').innerHTML = "<span style='color:#00ff9d'>DB Poke OK.</span>";
        }, 'msg-poke');

        loadJSON(NPC_DB_URL, (data) => {
            npcDB = data;
            document.getElementById('msg-npc').innerHTML = "<span style='color:#00ff9d'>DB NPC OK.</span>";
        }, 'msg-npc');

        loadJSON(MAP_FEATURES_URL, (data) => {
            mapFeatures = data;
            loadMap('kanto');
        }, 'layer-controls');

        // =========================================================
        // L√ìGICA DO MAPA
        // =========================================================
        let currentMapId = 'kanto'; 
        let mapInstance = L.map('map', { crs: L.CRS.Simple, minZoom: -3, maxZoom: 5, zoomControl: false });
        L.control.zoom({ position: 'topright' }).addTo(mapInstance);
        
        let currentImageOverlay = null;
        let activeMarkers = []; 
        let searchMarker = null;
        const layerGroups = {}; 

        // Listener de Clique para coordenadas (Pop-up + preenchimento de input)
        mapInstance.on('click', function(e) {
            const coords = mapToGame(e.latlng.lat, e.latlng.lng);
            L.popup()
                .setLatLng(e.latlng)
                .setContent(`<b>Coordenadas:</b><br>X: ${coords.x}<br>Y: ${coords.y}`)
                .openOn(mapInstance);
            
            document.getElementById('inputX').value = coords.x;
            document.getElementById('inputY').value = coords.y;
        });

        function gameToMap(gameX, gameY, mapId = currentMapId) {
            const cfg = mapsConfig[mapId];
            let pctX = (gameX - cfg.minX) / (cfg.maxX - cfg.minX);
            let pctY = (gameY - cfg.minY) / (cfg.maxY - cfg.minY);
            return [(1 - pctY) * cfg.height, pctX * cfg.width];
        }

        function mapToGame(lat, lng) {
            const cfg = mapsConfig[currentMapId];
            let pctX = lng / cfg.width;
            let pctY = 1 - (lat / cfg.height);
            return { x: Math.round((pctX * (cfg.maxX - cfg.minX)) + cfg.minX), y: Math.round((pctY * (cfg.maxY - cfg.minY)) + cfg.minY) };
        }

        function loadMap(mapId) {
            const cfg = mapsConfig[mapId];
            if (currentImageOverlay) mapInstance.removeLayer(currentImageOverlay);
            const bounds = [[0, 0], [cfg.height, cfg.width]];
            currentImageOverlay = L.imageOverlay(cfg.image, bounds).addTo(mapInstance);
            mapInstance.fitBounds(bounds);
            
            currentMapId = mapId;
            document.getElementById('mapSelector').value = mapId;
            
            activeMarkers.forEach(m => mapInstance.removeLayer(m));
            activeMarkers = [];
            if(searchMarker) mapInstance.removeLayer(searchMarker);
            
            setupStaticLayers(mapId);
        }

        function changeMap(mapId) { loadMap(mapId); }

        function buscarPokemon() {
            let nameInput = document.getElementById('inputPoke').value.toLowerCase().trim();
            let msg = document.getElementById('msg-poke');
            msg.innerHTML = "";
            activeMarkers.forEach(m => mapInstance.removeLayer(m));
            activeMarkers = [];
            if (pokemonDB[nameInput]) {
                let data = pokemonDB[nameInput];
                let countCurrentMap = 0;
                let otherMaps = new Set();
                let wikiUrl = data.wiki || `https://pokecroc.fandom.com/pt-br/wiki/${nameInput}`;
                data.locais.forEach((local) => {
                    if (local.map === currentMapId) {
                        countCurrentMap++;
                        let latlng = gameToMap(local.x, local.y, local.map);
                        let iconPoke = L.divIcon({
                            className: 'poke-icon',
                            html: `<img src="${data.sprite}" class="poke-img" style="width:60px; height:60px;" onerror="this.src='https://img.pokemondb.net/sprites/items/poke-ball.png'">`,
                            iconSize: [60, 60], iconAnchor: [30, 30], popupAnchor: [0, -30]
                        });
                        let popupContent = `<div style="text-align:center;"><b>${nameInput.toUpperCase()}</b><br><span style="font-size:11px;">${data.desc}</span><br>X: ${local.x}, Y: ${local.y}<br><span style="color:#d35400;">Qtd: ${local.qtd || '?'}</span><a href="${wikiUrl}" target="_blank" class="wiki-link">üìñ Ver na Wiki</a></div>`;
                        let marker = L.marker(latlng, {icon: iconPoke}).addTo(mapInstance).bindPopup(popupContent);
                        activeMarkers.push(marker);
                        if (countCurrentMap === 1) { mapInstance.setView(latlng, 2); marker.openPopup(); }
                    } else { otherMaps.add(local.map); }
                });
                updateSearchMsg(msg, countCurrentMap, otherMaps, 'buscarPokemon');
            } else { msg.innerText = "Pok√©mon n√£o cadastrado."; msg.style.color = "#ff5555"; }
        }

        function buscarNPC() {
            let input = document.getElementById('inputNPC').value.toLowerCase().trim();
            let msg = document.getElementById('msg-npc');
            msg.innerHTML = "";
            activeMarkers.forEach(m => mapInstance.removeLayer(m));
            activeMarkers = [];
            if (input === "") return;
            let foundKey = Object.keys(npcDB).find(key => key.toLowerCase().includes(input));
            if (foundKey) {
                let data = npcDB[foundKey];
                let countCurrentMap = 0;
                let otherMaps = new Set();
                data.locais.forEach(local => {
                    if (local.map === currentMapId) {
                        countCurrentMap++;
                        let latlng = gameToMap(local.x, local.y, local.map);
                        let icon = data.sprite ? L.divIcon({
                            className: 'legendary-icon',
                            html: `<img src="${data.sprite}" class="legendary-img" style="width:50px; height:50px;">`,
                            iconSize: [50, 50], iconAnchor: [25, 25], popupAnchor: [0, -25]
                        }) : L.divIcon({ className: 'custom-pin pin-blue', iconSize: [12,12] });
                        let popup = `<div style="text-align:center;"><b>${foundKey}</b><br><span style="font-size:11px;">${data.desc}</span><br>X: ${local.x}, Y: ${local.y}<br>Req: <span style="color:#f1c40f">${local.requisito || 'Nenhum'}</span><br><a href="${data.quest}" target="_blank" class="wiki-link">üìú Ver Quest</a></div>`;
                        let marker = L.marker(latlng, {icon: icon}).addTo(mapInstance).bindPopup(popup);
                        activeMarkers.push(marker);
                        if (countCurrentMap === 1) { mapInstance.setView(latlng, 2); marker.openPopup(); }
                    } else { otherMaps.add(local.map); }
                });
                updateSearchMsg(msg, countCurrentMap, otherMaps, 'buscarNPC', foundKey);
            } else {
                msg.innerText = "NPC n√£o encontrado."; msg.style.color = "#ff5555";
            }
        }

        function updateSearchMsg(msgEl, count, otherMaps, retryFunc, searchKey) {
            let htmlMsg = count > 0 ? `<span style="color:#00ff9d">Encontrado ${count} locais.</span><br>` : `<span style="color:#e74c3c">N√£o neste mapa.</span><br>`;
            if (otherMaps.size > 0) {
                htmlMsg += `<span style="color:#f1c40f;">Ver em:</span><br>`;
                let funcName = retryFunc === 'buscarNPC' ? `goToMapAndSearchNPC` : `goToMapAndSearch`;
                let arg = searchKey ? `'${searchKey}'` : '';
                otherMaps.forEach(m => { htmlMsg += `<button class="map-jump-btn" onclick="${funcName}('${m}', ${arg})">${mapsConfig[m].name}</button> `; });
            }
            msgEl.innerHTML = htmlMsg;
        }

        function goToMapAndSearch(mapId) { changeMap(mapId); setTimeout(buscarPokemon, 300); }
        function goToMapAndSearchNPC(mapId, key) { 
            changeMap(mapId); 
            if(key) document.getElementById('inputNPC').value = key; 
            setTimeout(buscarNPC, 300); 
        }

        function handleEnterPoke(e) { if(e.keyCode === 13) buscarPokemon(); }
        function handleEnterNPC(e) { if(e.keyCode === 13) buscarNPC(); }

        function buscarCoordenada() {
            let x = parseInt(document.getElementById('inputX').value);
            let y = parseInt(document.getElementById('inputY').value);
            let msg = document.getElementById('msg-busca');
            if (isNaN(x) || isNaN(y)) { msg.innerText = "Inv√°lido"; msg.style.color="red"; return; }
            let latlng = gameToMap(x, y, currentMapId);
            if (searchMarker) mapInstance.removeLayer(searchMarker);
            searchMarker = L.marker(latlng).addTo(mapInstance).bindPopup(`<b>Local</b><br>X: ${x}, Y: ${y}`).openPopup();
            mapInstance.setView(latlng, 3);
            msg.innerText = "Localizado!"; msg.style.color = "#00ff9d";
        }

        function createDynamicIcon(item, config) {
            if (config.type === 'text') {
                return L.divIcon({
                    className: 'city-label-icon',
                    html: `<span class="city-label-text" style="color:${config.color}">${item.name}</span>`,
                    iconSize: [100, 20], iconAnchor: [50, 10]
                });
            } else if (config.type === 'sprite') {
                let size = config.size || [40, 40];
                return L.divIcon({
                    className: 'legendary-icon',
                    html: `<img src="${item.sprite || 'https://img.pokemondb.net/sprites/items/poke-ball.png'}" class="legendary-img">`,
                    iconSize: size, iconAnchor: [size[0]/2, size[1]/2], popupAnchor: [0, -size[1]/2]
                });
            } else {
                return L.divIcon({ 
                    className: `custom-pin ${config.cssClass || 'pin-white'}`, 
                    iconSize: [12, 12], iconAnchor: [6, 6], popupAnchor: [0, -10] 
                });
            }
        }

        function setupStaticLayers(mapId) {
            const controlsDiv = document.getElementById('layer-controls');
            controlsDiv.innerHTML = '';
            for (let key in layerGroups) {
                if (mapInstance.hasLayer(layerGroups[key])) mapInstance.removeLayer(layerGroups[key]);
            }
            if (!mapFeatures || !mapFeatures[mapId]) return;
            const features = mapFeatures[mapId];
            for (let layerKey in layerConfig) {
                const config = layerConfig[layerKey];
                const items = features[layerKey];
                if (items && items.length > 0) {
                    const layer = L.layerGroup(items.map(item => 
                        L.marker(gameToMap(item.x, item.y, mapId), { 
                            icon: createDynamicIcon(item, config),
                            zIndexOffset: (config.type === 'text' ? 1000 : 0)
                        }).bindPopup(`<b>${item.name}</b><br>X:${item.x}, Y:${item.y}`)
                    ));
                    layerGroups[layerKey] = layer;
                    if (layerKey === 'cidades') mapInstance.addLayer(layer);
                    createCheckbox(config.label, layerKey, (layerKey === 'cidades'));
                }
            }
        }

        function createCheckbox(label, layerKey, isChecked) {
            const div = document.getElementById('layer-controls');
            const labelEl = document.createElement('label');
            labelEl.className = 'layer-item';
            let color = '#fff';
            if (layerKey === 'cidades') color = '#f1c40f';
            if (layerKey === 'lendarios') color = '#ff00ff';
            labelEl.style.color = color;
            labelEl.innerHTML = `<input type="checkbox" onchange="toggleLayer('${layerKey}')" ${isChecked ? 'checked' : ''}> ${label}`;
            div.appendChild(labelEl);
        }

        function toggleLayer(name) {
            if (mapInstance.hasLayer(layerGroups[name])) { mapInstance.removeLayer(layerGroups[name]); } 
            else { mapInstance.addLayer(layerGroups[name]); }
        }

        function toggleTopMenu() {
            const panel = document.getElementById('top-menu-panel');
            const trigger = document.getElementById('top-menu-trigger');
            if (panel.classList.contains('open')) {
                panel.classList.remove('open');
                trigger.classList.remove('open');
                trigger.innerText = "‚ñº";
            } else {
                panel.classList.add('open');
                trigger.classList.add('open');
                trigger.innerText = "‚ñ≤";
            }
        }

        const overlay = document.getElementById('login-overlay');
        async function verificarAcesso() {
            const tokenSalvo = localStorage.getItem('pokecroc_token');
            if (tokenSalvo) {
                try {
                    const req = await fetch('/api/verify', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ token: tokenSalvo }) });
                    const res = await req.json();
                    if (res.valid) { overlay.style.display = 'none'; return; }
                } catch (e) { console.log("Erro verif token"); }
            }
        }
        async function tentarLogin() {
            const pass = document.getElementById('sitePassword').value;
            const btn = document.getElementById('btnLogin');
            const msg = document.getElementById('loginMsg');
            btn.disabled = true; btn.innerText = "Verificando..."; msg.innerText = "";
            try {
                const req = await fetch('/api/login', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ password: pass }) });
                const res = await req.json();
                if (res.success) { localStorage.setItem('pokecroc_token', res.token); overlay.style.display = 'none'; } 
                else { msg.innerText = "Senha incorreta!"; btn.disabled = false; btn.innerText = "LIBERAR ACESSO"; }
            } catch (e) { msg.innerText = "Erro de conex√£o."; btn.disabled = false; btn.innerText = "LIBERAR ACESSO"; }
        }
        verificarAcesso();
    </script>
</body>
</html>